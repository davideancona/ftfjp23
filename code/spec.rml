new_hash(hash_id) matches {event:'func_post', name:'HashSet', resultId:hash_id};
not_new_hash not matches new_hash(_);
modify(targ_id) matches {event:'func_post', targetId:targ_id, name:'add' | 'remove', res:true};
not_modify(targ_id) not matches modify(targ_id);
modify(hash_id,elem_id) matches modify(hash_id) | modify(elem_id);
add(hash_id,elem_id) matches {event:'func_post', targetId:hash_id, name:'add', argIds:[elem_id], res:true};
not_add(hash_id) not matches add(hash_id,_);
remove(hash_id,elem_id) matches {event:'func_post', targetId:hash_id, name:'remove', argIds:[elem_id], res:true};
op(hash_id,elem_id) matches {targetId:hash_id} | {elem_id:hash_id};
relevant matches new_hash(_) | modify(_);

Main = relevant >> SafeHash;
SafeHash = not_new_hash* {let hash_id;new_hash(hash_id) (SafeHashTable<hash_id> /\ SafeHash)}?;
SafeHashTable<hash_id> = not_add(hash_id)* {let elem_id;add(hash_id,elem_id) (SafeHashElem<hash_id,elem_id> /\ SafeHashTable<hash_id>)};
SafeHashElem<hash_id,elem_id> = op(hash_id,elem_id) >> not_modify(elem_id)* remove(hash_id,elem_id) all;
